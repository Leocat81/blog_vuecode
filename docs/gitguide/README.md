# Git

&nbsp;&nbsp; git ç‰ˆæœ¬å›æ»šæœ‰ä¸¤ç§æ–¹å¼ï¼Œå…¶ä¸€ä¸º`Git Reset`,å…¶äºŒä¸º`Git Revert`ã€‚ä¸‹é¢æ¥çœ‹è¿™ç§å…·ä½“æ“ä½œåŠå®ç°ã€‚æ–‡æœ«å¯¹ä¸¤ç§æ–¹å¼è¿›è¡Œæ€»ç»“å’Œæ¯”è¾ƒã€‚

## å…‹éš†

`git clone`ç”¨äºæ‹‰å–è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°

```bash
/* git clone è¿œç¨‹ä»“åº“åœ°å€ æœ¬åœ°ç›®å½• */
$ git clone https://gitee.com/pipepandafeng/blog_vuecode.git blog_vuecode_local
```

## æ‹‰å–

`git fetch` å’Œ`git pull` éƒ½ç”¨äºä»£ç å’Œåˆ†æ”¯çš„æ›´æ–°ã€‚

- <h3>git fetch</h3>

ä¸€æ—¦è¿œç¨‹ä¸»æœºçš„ç‰ˆæœ¬åº“æœ‰äº†æ›´æ–°ï¼ˆGit æœ¯è¯­å«åš commitï¼‰ï¼Œéœ€è¦å°†è¿™äº›æ›´æ–°å–å›æœ¬åœ°ï¼Œè¿™æ—¶å°±è¦ç”¨åˆ° git fetch å‘½ä»¤ã€‚

```bash
/*
 * git fetch ä¸»æœºå è¿œç¨‹åˆ†æ”¯:æœ¬åœ°åˆ†æ”¯ï¼ˆåˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ï¼‰
 * ç‰¹åˆ«æ³¨æ„:ä¸å»ºè®®æœ¬åœ°åˆ†æ”¯å†™æœ¬åœ°å·²æœ‰åˆ†æ”¯ï¼Œå¦åˆ™æ‹‰å–å½“æœ‰å†²çªæ—¶å¯èƒ½ä¼šæœ‰é—®é¢˜
*/
##1ï¼šæ‹‰å–æ›´æ–°åˆ°æœ¬åœ°æ–°å»ºtmpåˆ†æ”¯
$ git fetch origin master:tmp
##2ï¼šåˆå¹¶æ›´æ–°
$ git merge tmp
##3: å½“æœ‰å†²çªæ—¶ï¼Œæ‰‹åŠ¨è§£å†³å†²çª ç„¶ågit add .| git commit -m ""ã€‚æ— å†²çªæ—¶ æœ€åç›´æ¥push
$ git push origin master
```

- <h3>git pull</h3>

```bash
/*
 * git pull ä¸»æœºå è¿œç¨‹åˆ†æ”¯:æœ¬åœ°åˆ†æ”¯ï¼ˆæ— åˆ™åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ï¼‰
*/
##1ï¼šå–å›originä¸»æœºçš„masteråˆ†æ”¯ï¼Œä¸æœ¬åœ°çš„devåˆ†æ”¯åˆå¹¶
## || å¦‚æœè¿œç¨‹åˆ†æ”¯æ˜¯ä¸å½“å‰åˆ†æ”¯åˆå¹¶ï¼Œåˆ™å†’å·åé¢çš„éƒ¨åˆ†å¯ä»¥çœç•¥ã€‚
$ git pull origin master:dev || git pull origin master
##2: å½“æœ‰å†²çªæ—¶ï¼Œæ‰‹åŠ¨è§£å†³å†²çª ç„¶ågit add .| git commit -m ""ã€‚æ— å†²çªæ—¶ æœ€åç›´æ¥push
$ git push origin master
```

::: tip ç»“è®º
git fetch æ˜¯ä»è¿œç¨‹è·å–æœ€æ–°ç‰ˆæœ¬åˆ°æœ¬åœ°ï¼Œä½†ä¸ä¼šè‡ªåŠ¨ mergeã€‚
è€Œ git pull åˆ™æ˜¯ä¼šè·å–æ‰€æœ‰è¿œç¨‹ç´¢å¼•å¹¶åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯ä¸­æ¥ã€‚æ•ˆæœç›¸åŒæ—¶ git pull å°†æ›´ä¸ºå¿«æ·ã€‚
:::

## åˆ†æ”¯

- <h3>åŸºç¡€æ“ä½œ</h3>

- `git branch`ç”¨äºæŸ¥çœ‹æœ¬åœ°åˆ†æ”¯
- `git branch -a`æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ï¼ˆåŒ…æ‹¬è¿œç¨‹åˆ†æ”¯ï¼‰
- `git branch XXX`æ–°å»ºä¸€ä¸ªåˆ†æ”¯
- `git checkout master` åˆ‡æ¢åˆ†æ”¯
- `git checkout -t orgin/master` æœ¬åœ°åˆ›å»ºä¸€ä¸ª master å¹¶å»ºç«‹ä¸€ä¸ªè¿½è¸ªå…³ç³»ï¼Œè‡ªåŠ¨è¿½è¸ªè¿œç¨‹åˆ†æ”¯ï¼ˆorigin/master)

- <h3>åŒæ­¥æœ¬åœ°ä¸çº¿ä¸Šåˆ†æ”¯</h3>

ğŸ”” å°†çº¿ä¸Šæ–°å¢åˆ†æ”¯æ›´æ–°åˆ°æœ¬åœ°

ç¬¬ä¸€ç§æ–¹å¼ï¼šæ‹‰å–åˆ†æ”¯ä¸åˆ›å»ºæœ¬åœ°åˆ†æ”¯,å…¶åä¸€æ­¥å®Œæˆåˆ›å»ºåˆ†æ”¯ä¸å»ºç«‹è¿½è¸ªå…³ç³»

```bash
##1ï¼šæ‹‰å–è¿œç¨‹åˆ†æ”¯(ä¸åˆ›å»ºæœ¬åœ°åˆ†æ”¯)
$ git pull || git fetch
##2ï¼šå»ºç«‹æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„è¿½è¸ªå…³ç³»
$ git checkout -t orgin/XXX
```

ç¬¬äºŒç§æ–¹å¼ æ‹‰å–åˆ†æ”¯å°±åˆ›å»ºæœ¬åœ°åˆ†æ”¯ï¼Œä½†æ­¤æ—¶è¿½è¸ªå…³ç³»æœªåˆ›å»ºï¼Œå…¶åæ‰‹åŠ¨å»ºç«‹è¿½è¸ªå…³ç³»

```bash
##1ï¼šæ‹‰å–è¿œç¨‹åˆ†æ”¯ï¼ˆæœ¬åœ°æ²¡æœ‰çš„è¯ï¼Œåˆ›å»ºä¸è¿œç¨‹åˆ†æ”¯åŒåçš„æœ¬åœ°åˆ†æ”¯ï¼‰
git pull origin XXX || git fetch origin XXX:XXX
##2ï¼šæ‰‹åŠ¨æŒ‡å®šæœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„è¿½è¸ªå…³ç³»
$ git branch --set-upstream-to=origin/master master
```

ğŸ”” å°†çº¿ä¸Šåˆ é™¤åˆ†æ”¯æ›´æ–°åˆ°æœ¬åœ°

å¦‚æœè¿œç¨‹ä¸»æœºåˆ é™¤äº†æŸä¸ªåˆ†æ”¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œgit pull ä¸ä¼šåœ¨æ‹‰å–è¿œç¨‹åˆ†æ”¯çš„æ—¶å€™ï¼Œåˆ é™¤å¯¹åº”çš„æœ¬åœ°åˆ†æ”¯ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢ï¼Œç”±äºå…¶ä»–äººæ“ä½œäº†è¿œç¨‹ä¸»æœºï¼Œå¯¼è‡´ git pull ä¸çŸ¥ä¸è§‰åˆ é™¤äº†æœ¬åœ°åˆ†æ”¯ã€‚

ä½†æ˜¯ï¼Œä½ å¯ä»¥æ”¹å˜è¿™ä¸ªè¡Œä¸ºï¼ŒåŠ ä¸Šå‚æ•° -p å°±ä¼šåœ¨æœ¬åœ°åˆ é™¤è¿œç¨‹å·²ç»åˆ é™¤çš„åˆ†æ”¯ã€‚

```bash
$ git pull -p
# ç­‰åŒäºä¸‹é¢çš„å‘½ä»¤
$ git fetch --prune origin
$ git fetch -p
```

- <h3>è¿½è¸ªå…³ç³»ï¼ˆtrackingï¼‰</h3>

æŸ¥çœ‹åˆ†æ”¯è·Ÿè¸ªçš„è¿œç¨‹åˆ†æ”¯

```bash
$ git branch --vv

  dev    04c3d8f [origin/dev] update README.md.
  dev1   6203f67 [origin/dev1] update README.md.
* master d672abc [origin/master] update README.md.
  tmp    219538d update README.md.

```

åœ¨æŸäº›åœºåˆï¼ŒGit ä¼šè‡ªåŠ¨åœ¨æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯ä¹‹é—´ï¼Œå»ºç«‹ä¸€ç§è¿½è¸ªå…³ç³»ï¼ˆtrackingï¼‰ã€‚æ¯”å¦‚ï¼Œåœ¨ git clone çš„æ—¶å€™ï¼Œæ‰€æœ‰æœ¬åœ°åˆ†æ”¯é»˜è®¤ä¸è¿œç¨‹ä¸»æœºçš„åŒååˆ†æ”¯ï¼Œå»ºç«‹è¿½è¸ªå…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬åœ°çš„ master åˆ†æ”¯è‡ªåŠ¨"è¿½è¸ª"origin/master åˆ†æ”¯ã€‚

Git ä¹Ÿå…è®¸æ‰‹åŠ¨å»ºç«‹è¿½è¸ªå…³ç³»ã€‚

```bash
##è¯¥å‘½ä»¤æŒ‡å®šmasteråˆ†æ”¯è¿½è¸ªorigin/nextåˆ†æ”¯ã€‚
$ git branch --set-upstream master origin/next
##è¯¥å‘½ä»¤åˆ›å»ºä¸€ä¸ªæœ¬åœ° master å¹¶å»ºç«‹ä¸€ä¸ªè¿½è¸ªå…³ç³»ï¼Œè‡ªåŠ¨è¿½è¸ªè¿œç¨‹åˆ†æ”¯ï¼ˆorigin/master)
$ git checkout -t orgin/master
```

å¦‚æœ<b>å½“å‰åˆ†æ”¯</b>ä¸è¿œç¨‹åˆ†æ”¯å­˜åœ¨è¿½è¸ªå…³ç³»ï¼Œgit pull å°±å¯ä»¥çœç•¥è¿œç¨‹åˆ†æ”¯åã€‚

```bash
##è¯¥å‘½ä»¤è¡¨ç¤ºï¼Œæœ¬åœ°çš„å½“å‰åˆ†æ”¯è‡ªåŠ¨ä¸å¯¹åº”çš„originä¸»æœº"è¿½è¸ªåˆ†æ”¯"ï¼ˆremote-tracking branchï¼‰è¿›è¡Œåˆå¹¶ã€‚
$ git pull origin
```

<b>å¦‚æœå½“å‰åˆ†æ”¯åªæœ‰ä¸€ä¸ªè¿½è¸ªåˆ†æ”¯</b>ï¼Œè¿è¿œç¨‹ä¸»æœºåéƒ½å¯ä»¥çœç•¥ã€‚

```bash
$ git pull
```

## å†²çª

`git merge`å’Œ`git rebase`éƒ½ç”¨äºè§£å†³å†²çª

- `git log --oneline --graph --decorate --all` ä»¥æ ‘å½¢å¼æŸ¥çœ‹ git æäº¤å†å²è®°å½•
- vscode ä¸­ `Git Graph` ä¹Ÿå¯ä»¥ä»¥æ ‘å½¢å¼æŸ¥çœ‹ git æäº¤å†å²è®°å½•

å…¶ä¸‹æ‰€æœ‰ä¾‹å­å‡å‡è®¾æœ‰ä¸¤ä¸ªåˆ†æ”¯`masterï¼Œdev`ã€‚`master` åˆ†æ”¯å’Œ `dev` æœ‰æ— å†²çªä¸¤ç§æƒ…å†µï¼Œç°éœ€è¦å°† `dev` åˆ†æ”¯åˆå¹¶åˆ° `master` ä¸Šã€‚

<h3>1ï¸âƒ£ git merge</h3>

- æ— å†²çª

```bash
$ git checkout master
$ git merge dev
$ git push origin master
```

- æœ‰å†²çª

```bash
$ git checkout master
$ git merge dev
## æ‰‹åŠ¨è§£å†³å†²çª
$ git add .
$ git commit -m "dev merge to master"
$ git push origin master
```

![RUNOOB å›¾æ ‡](../assets/git_merge.png)

å¯ä»¥çœ‹åˆ°å½“ä»…ä»…ä½¿ç”¨ git merge å¤„ç†å†²çªæ—¶ï¼Œå†ä¸»åˆ†æ”¯ä¸Šä¼šå‡ºç°ä¸€æ¡åˆ†å‰åˆ†æ”¯ï¼Œé€šè¿‡åˆå¹¶å†²çªåï¼Œ
åˆ†å‰çš„åˆ†æ”¯å†æ¬¡åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸Šï¼Œæ­¤æ—¶ä¼šå¤šä¸€æ¡ commit,ç”¨äºæè¿°åˆå¹¶ä¿¡æ¯ã€‚git merge æ“ä½œç®€å•ï¼Œ
ä½†å¯¹ git history æäº¤å†å²çœ‹ä¸Šå»ä¸å¤ªå‹å¥½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ git rebase ç»“åˆ git merge ä½¿ç”¨ï¼Œ
ä»¥æ‰“åˆ°ä¼˜åŒ– git hostory æ•ˆæœã€‚

<h3>2ï¸âƒ£ git rebase ç»“åˆ git merge å¤„ç†å†²çª</h3>

- æ— å†²çª

```bash
$ git checkout dev
$ git rebase master
$ git checkout master
$ git merge dev
$ git push origin master
```

- æœ‰å†²çª

```bash
$ git checkout dev
$ git rebase master
## æ‰‹åŠ¨è§£å†³å†²çª
$ git rebase --continue
## å¦‚è¿˜æœ‰å†²çªï¼Œç»§ç»­æ‰‹åŠ¨è§£å†³å†²çª
## æœ€åæƒ…å†µï¼Œæ¯”å¦‚æäº¤äº†ä¸‰æ¬¡ï¼Œæ¯æ¬¡éƒ½æœ‰å†²çªï¼Œåˆ™éœ€é‡å¤æ­¤æ­¥éª¤ä¸‰æ¬¡
## å¯ä»¥ä½¿ç”¨ git rebase -i å°†å¤šä¸ªcommit åˆå¹¶ä¸ºä¸€ä¸ªcommitï¼Œä»è€Œåªè§£å†³ä¸€æ¬¡å†²çªå³å¯
$ git rebase --continue
## å†²çªå…¨éƒ¨è§£å†³å®Œæˆ
$ git checkout master
$ git merge dev
$ git push origin master
```

![RUNOOB å›¾æ ‡](../assets/git_diff.png)

::: tip

- ç”¨ rebase è§£å†³å†²çªæ—¶ï¼Œå¯ä»¥éšæ—¶ä½¿ç”¨ git rebase --abort é€€å‡ºï¼Œå°†ä»£ç é€€å› rebase ä¹‹å‰ã€‚
- å¯ä»¥ä½¿ç”¨ git rebase -i å°†å¤šä¸ª commit åˆå¹¶ä¸ºä¸€ä¸ª commitï¼Œä»è€Œåªè§£å†³ä¸€æ¬¡å†²çªå³å¯ã€‚é¿å…å¯¹æ­¤æ‰§è¡Œ git reabse --continue

:::

å¯ä»¥çœ‹åˆ°å½“ä½¿ç”¨ git rebase ç»“åˆ git merge åï¼Œæˆ‘ä»¬çš„ Git History å˜ä¸ºäº†çº¿æ€§æ’åºï¼Œåˆ©äºæˆ‘ä»¬æŸ¥çœ‹ git çš„å†å²ä¿¡æ¯ã€‚

<h3>3ï¸âƒ£ git pull â€“rebase å¤„ç†å†²çª</h3>

ä¸ä¸Šé¢è§£å†³å†²çªåŒç†
git rebase master

<h3>4ï¸âƒ£ git rebase -i HEAD~</h3>

- <a href="https://www.jianshu.com/p/ec45ce13289f" target="_blank">ä¿®æ”¹å·²ç» push çš„ commit message</a>

## å›æ»š

`git reset`å’Œ`git revert`éƒ½å¯ç”¨äºä»£ç ç‰ˆæœ¬å›æ»š

<h3> 1ï¸âƒ£ git reset </h3>

`git rese`æ˜¯å›é€€åˆ°æŸä¸ª commit ID ç‰ˆæœ¬ä½ç½®

```bash
# æŸ¥è¯¢commitID
$ git log
# æ‰§è¡Œç‰ˆæœ¬å›é€€
$ git reset --hard [commitID]
# å¼ºåˆ¶pushä»£ç åˆ°è¿œç¨‹ä»“åº“
$ git push -f
```

<h3> 1ï¸âƒ£ git revert </h3>

`git revert`æ˜¯æ’¤é”€æŸä¸ª commit ID ç‰ˆæœ¬ï¼Œä¼šæ’¤é”€æŸä¸ª commitID çš„æäº¤ã€‚

```bash
# æŸ¥è¯¢commitID
$ git log
# æ‰§è¡Œç‰ˆæœ¬å›é€€
$ git revert -n [commitID]
# å‡ºç°å†²çªå°±è§£å†³å†²çªï¼Œå¦‚æ— å†²çª
$ git commit -m "ç‰ˆæœ¬å"
# pushä»£ç åˆ°è¿œç¨‹ä»“åº“
$ git push
```

![RUNOOB å›¾æ ‡](../assets/git_revert.png)

::: warning

- `git reset`æ˜¯å›é€€åˆ°æŸä¸ª commitID ç‰ˆæœ¬å†å²ï¼Œ`git revert`æ˜¯æ’¤é”€æŸä¸ª commitID å¾—æäº¤ã€‚

- `git reset`ä¸ä¼šä¿ç•™ commitID ä¹‹åçš„æäº¤è®°å½•ï¼Œ`git revert`ä¸ä¼šå¯¹ commitID ä¹‹å‰å’Œä¹‹åçš„ commit äº§ç”Ÿå½±å“ï¼Œä½†ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ commitã€‚

:::
